@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.i18n.Messages.Implicits._
@import play.api.Play.current

@(errorMessage:String,
 taxYearRange:TaxYearRange,
 isCurrentTaxYear:String= "", code:Int = 0,
 pageHeading:String ="An error has occurred",
 backLink:String= "overview")(implicit request:Request[_],
                              ac: uk.gov.hmrc.play.frontend.auth.AuthContext ,
                              context: config.PbikContext, applicationMessages: Messages)

@import utils.FormMappingsConstants._
@import uk.gov.hmrc.play.views.html.helpers

@active(ac: uk.gov.hmrc.play.frontend.auth.AuthContext) = @{
    if (ac.principal.accounts.epaye.isDefined)
    Some( ac.principal.accounts.epaye.get.empRef.toString )
    else
    Some("")
}

@parentTemplate(pageTitle = Messages("Service.title"), Some(taxYearRange), active(ac) ) {

    @isCurrentTaxYear match {
        case utils.FormMappingsConstants.CY => {<h1 id="title">@Messages(pageHeading,taxYearRange.cyminus1.toString, taxYearRange.cy.toString)</h1>}
        case utils.FormMappingsConstants.CYP1 => {<h1 id="title">@Messages(pageHeading, taxYearRange.cy.toString, taxYearRange.cyplus1.toString)</h1>}
        case _ if(code >= 0) => {<h1 id="title">@Messages("ServiceMessage." + (code) + ".h1")</h1>}
        case _ => {<h1 id="title">@Messages(errorMessage + "", "", "")</h1>}
    }

    <p class="lede-para text">
     @isCurrentTaxYear match {
            case utils.FormMappingsConstants.CY => {@Html(Messages(errorMessage + isCurrentTaxYear , taxYearRange.cyminus1.toString, taxYearRange.cy.toString))}
            case utils.FormMappingsConstants.CYP1 => {@Html(Messages(errorMessage + isCurrentTaxYear , taxYearRange.cy.toString, taxYearRange.cyplus1.toString))}
            case _ if(code == 63091) => {

                @Html(Messages("ServiceMessage." + (code)))

            }
            case _ if(code == 63088 || code == 64989 || code == 10003)  => {

                @Html(Messages("ServiceMessage." + (code) + ".1"))

            }
            case _ => {@Html(Messages(errorMessage))}
        }
    </p>

    <p class="text">
        @if(code == 63088 || code == 64989 || code == 10003) {

            @Html(Messages("ServiceMessage." + (code) + ".2"))
        }
    </p>


    @code match {
        case 63082 => {<a id="link-try-again" href='javascript: window.history.go(-1)'>@Messages("Service.tryagain")</a>}
        case 63085 => {<a id="link-add-another" href='javascript: window.history.go(-1)'>@Messages("Service.excludeanotheremployee")</a>}
        case 63090 => {<a id="link-add-another" href='javascript: window.history.go(-1)'>@Messages("Service.excludeanotheremployee")</a>}
        case 63092 => {<a id="link-add-another" href='javascript: window.history.go(-1)'>@Messages("Service.excludeanotheremployee")</a>}
        case _ => {}
    }

    <p>
        @backLink match {
            case _ if(code != 0 && code != 10001 && code != 65176 && code!=65355)=>{
                <a id="link-back" onclick="gaEventLinkOverview()" href='@routes.HomePageController.onPageLoad'>
                    @Messages("Service.back.overview")</a>}
            case _ => {
                <a id="link-back" onclick="gaEventLinkOverview()" href='@routes.HomePageController.onPageLoad'>
                    @Messages("Service.back.overview")</a>
            }
        }
    </p>

}
