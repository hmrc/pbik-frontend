@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.i18n.Messages.Implicits._
@import play.api.Play.current

@(cyAllowed: Boolean,
taxYearRange:TaxYearRange,
registeredBenefitsCurrentYear: List[Bik],
registeredBenefitsNextYear: List[Bik],
serviceBiksCountCY: Int,
serviceBiksCountCYP1: Int,
fromYTA: String,
empRef: EmpRef)(implicit request:Request[_],
context: config.PbikContext, applicationMessages: Messages)

@import uk.gov.hmrc.play.views.html.helpers
@import utils.BikListUtils._
@import utils.TaxDateUtils._
@import utils.URIInformation._
@import java.util.Calendar

@import config.PbikAppConfig.biksDecommissioned

@sidebarLinks={
<div class="sidebar-side-bar">
    @sidebar.helpAndContact()
</div>
}

@parentTemplate(pageTitle = Messages("Overview.heading") + " - " + Messages("Service.title"), None, Some(empRef.toString), true,
showYTAlink = true, sidebarLinks = Some(sidebarLinks)) {

<h1 id="title">@Messages("Overview.heading")</h1>

<section id="what-to-do">

    @if(dateWithinAnnualCodingRun(Calendar.getInstance.getTime)) {
    <div id="latest-updates-message" class="panel-indent panel-border-wide">
        <span>@Messages("Service.news.banner.message")</span>
    </div>
    }

    <h2 id="heading-cy1">
        @Messages("Overview.next.heading", taxYearRange.cy + "", taxYearRange.cyplus1 + "")</h2>

    @if(!registeredBenefitsNextYear.isEmpty) {
    <p>
        @Messages("Overview.next.lead")
    </p>

    <h3 class="heading-medium">
        @Messages("Overview.table.heading.1")
    </h3>
    <dl class="govuk-check-your-answers cya-questions-long">
        @for( (n, index) <- sortAlphabeticallyByLabels(registeredBenefitsNextYear).zipWithIndex ) {
        <div>
            <div class="cya-question" id="cy1-@n.iabdType">
                @Messages("BenefitInKind.label." + n.iabdType)
            </div>
            <div class="cya-answer">
                <a id="cy1-exclude-@n.iabdType" href='@controllers.routes.ExclusionListController.performPageLoad("cyp1", iabdValueURLMapper(n.iabdType))'>
                    @if(n.eilCount == 0) {@Messages("Overview.table.exclude.none.link")} else {@Messages("Overview.table.exclude.link")}
                    @if(n.eilCount > 0) {(@n.eilCount)}
                    <span class="visuallyhidden">@Messages("Overview.current.from") @Messages("BenefitInKind.label." + n.iabdType)</span>
                </a>
            </div>
            <div class="cya-change">
                <a id="cy1-remove-@n.iabdType" href="@controllers.registration.routes.ManageRegistrationController.confirmRemoveNextTaxYearNoForm(iabdValueURLMapper(n.iabdType))">
                   <span aria-hidden="true">@Messages("Overview.table.remove.link")</span>
                    <span class="visuallyhidden">@Messages("Overview.current.remove") @Messages("BenefitInKind.label." + n.iabdType) @Messages("Overview.current.from") @Messages("Overview.current.payroll.p11d")</span>
                </a>
            </div>
        </div>
        }
     </dl>
    }else {
    <p id="no-benefits">
        @Messages("Overview.next.lead.empty", taxYearRange.cy + "")
    </p>
    }

    @if(registeredBenefitsNextYear.size < (serviceBiksCountCYP1 - biksDecommissioned.size)) {
    <a class="button" role="button" id="add-next" href="@controllers.registration.routes.ManageRegistrationController.nextTaxYearAddOnPageLoad">
        @if(registeredBenefitsNextYear.size > 0) {
        @Messages("Overview.table.add.link.more")
        }else {
        @Messages("Overview.table.add.link")
        }
    </a>
    }
    <div style="clear:both"></div>


    @if(cyAllowed || !registeredBenefitsCurrentYear.isEmpty) {
    <h2>@Messages("Overview.current.heading", taxYearRange.cyminus1 + "", taxYearRange.cy + "")</h2>

    @if(!registeredBenefitsCurrentYear.isEmpty) {
    <p>
        @Messages("Overview.current.lead")
    </p>
    }else {
    <p>
        @Messages("Overview.current.lead.empty", taxYearRange.cyminus1 + "")
    </p>
    }
    @if(!cyAllowed) {

    }
    @if(!registeredBenefitsCurrentYear.isEmpty) {

    <dl class="govuk-check-your-answers cya-questions-short">
        @for( (n, index) <- sortAlphabeticallyByLabels(registeredBenefitsCurrentYear).zipWithIndex ) {
        <div>
            <div class="cya-question" id="cy-@n.iabdType">
                @Messages("BenefitInKind.label." + n.iabdType)
            </div>
            <div class="cya-answer">
                <a id="cy-exclude-@n.iabdType" href='@controllers.routes.ExclusionListController.performPageLoad("cy", iabdValueURLMapper(n.iabdType))'>
                    @if(n.eilCount == 0) {@Messages("Overview.table.exclude.none.link")} else {@Messages("Overview.table.exclude.link")}
                    @if(n.eilCount > 0) {(@n.eilCount)}
                    <span class="visuallyhidden"> @Messages("Overview.current.from") @Messages("BenefitInKind.label." + n.iabdType)</span>
                </a>
            </div>

        </div>
        }

    </dl>
    }

    @if(cyAllowed) {
    @if(registeredBenefitsCurrentYear.size < (serviceBiksCountCY-biksDecommissioned.size)) {
    <a class="button" role="button" id="add-next" href="@controllers.registration.routes.ManageRegistrationController.currentTaxYearOnPageLoad">
        @if(registeredBenefitsCurrentYear.size > 0) {
        @Messages("Overview.table.add.link.more")
        }else {
        @Messages("Overview.table.add.link")
        }
    </a>
    }
    }
    }

    <div style="display:none" id="is-service-launched-indicator">@cyAllowed</div>

</section>

}
